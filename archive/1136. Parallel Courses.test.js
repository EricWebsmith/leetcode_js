const { expect } = require("chai");

/**
 * @param {number} n
 * @param {number[][]} relations
 * @return {number}
 */
function minimumSemesters (n, relations) {
    const dependencies = {};
    for (const relation of relations) {
        if(!dependencies.hasOwnProperty(relation[1])) {
            dependencies[relation[1]] = [];
        }

        dependencies[relation[1]].push(relation[0]);
    }

    let ans = 1;
    let hasCircle = false;
    const visited = new Set();
    function dfs(i, length) {
        // if (visited.has(i)) {
        //     return;
        // }
        visited.add(i);
        if (length > n) {
            hasCircle = true;
            return;
        }

        if(!dependencies.hasOwnProperty(i)) {
            ans = Math.max(ans, length);
            return;
        }

        for (const next of dependencies[i]) {
            dfs(next, length+1);
        }
    }

    for (const key of Object.keys(dependencies)) {
        if (visited.has(key)) {
            continue;
        }
        dfs(key, 1);
        if (hasCircle){
            return -1;
        }
    }

    return ans;
}

function test(...args) {
    const expected = args.pop();
    const actual = minimumSemesters (...args);
    if (actual !== expected) {
        console.log(actual, expected);
    }
    expect(actual).to.be.eql(expected);
}

describe('1136. Parallel Courses', () => {
    it('1136. 1', () => {test(3, [[1,3],[2,3]], 2)});
    it('1136. 2', () => {test(3, [[1,2],[2,3],[3,1]], -1)});
    it('1136. 3', () => {test(25, [[5,10],[11,14],[21,22],[16,19],[21,25],[6,18],[1,9],[4,7],[10,23],[5,14],[9,18],[18,21],[11,22],[1,15],[1,2],[5,18],[7,20],[2,23],[12,13],[9,14],[10,16],[11,21],[5,12],[2,24],[8,17],[15,17],[10,13],[11,16],[20,22],[7,11],[9,15],[16,22],[18,20],[19,22],[10,18],[3,20],[16,25],[10,15],[1,23],[13,16],[23,25],[1,8],[4,10],[19,24],[11,20],[3,18],[6,25],[11,13],[13,15],[22,24],[6,24],[17,20],[2,25],[15,24],[8,21],[14,16],[5,16],[19,23],[1,5],[4,22],[19,20],[12,15],[16,18],[9,13],[13,22],[14,22],[2,8],[3,13],[9,23],[14,15],[14,17],[8,20],[9,17],[3,19],[8,25],[2,12],[7,24],[19,25],[1,13],[6,11],[14,21],[7,15],[3,14],[15,23],[10,17],[4,20],[6,14],[10,21],[2,13],[3,21],[8,11],[5,21],[6,23],[17,25],[16,21],[12,22],[1,16],[6,19],[7,25],[3,23],[11,25],[3,10],[6,7],[2,3],[5,25],[1,6],[4,17],[2,16],[13,17],[17,22],[6,13],[5,6],[4,11],[4,23],[4,8],[12,23],[7,21],[5,20],[3,24],[2,10],[13,14],[11,24],[1,3],[2,7],[7,23],[6,17],[5,17],[16,17],[8,15],[8,23],[7,17],[14,18],[16,23],[23,24],[4,12],[17,19],[5,9],[10,11],[5,23],[2,9],[1,19],[2,19],[12,20],[2,14],[11,12],[1,12],[13,23],[4,9],[7,13],[15,20],[21,24],[8,18],[9,11],[8,19],[6,22],[16,20],[22,25],[20,21],[6,16],[3,17],[1,22],[9,22],[20,24],[2,6],[9,16],[2,4],[2,20],[20,25],[9,10],[3,11],[15,18],[1,20],[3,6],[8,14],[10,22],[12,21],[7,8],[8,16],[9,20],[3,8],[15,21],[17,21],[11,18],[13,24],[17,24],[6,20],[4,15],[6,15],[3,22],[13,21],[2,22],[13,25],[9,12],[4,19],[1,24],[12,19],[5,8],[1,7],[3,16],[3,5],[12,24],[3,12],[2,17],[18,22],[4,25],[8,24],[15,19],[18,23],[1,4],[1,21],[10,24],[20,23],[4,14],[16,24],[10,20],[18,24],[1,14],[12,14],[10,12],[4,16],[5,19],[4,5],[19,21],[15,25],[1,18],[2,21],[4,24],[7,14],[4,6],[15,16],[3,7],[21,23],[1,17],[12,16],[13,18],[5,7],[9,19],[2,15],[22,23],[7,19],[17,23],[8,22],[11,17],[7,16],[8,9],[6,21],[4,21],[4,13],[14,24],[3,4],[7,18],[11,15],[5,11],[12,17],[6,9],[1,25],[12,18],[6,12],[8,10],[6,8],[11,23],[7,10],[14,25],[14,23],[12,25],[5,24],[10,19],[3,25],[7,9],[8,12],[5,22],[24,25],[13,19],[3,15],[5,15],[15,22],[10,14],[3,9],[13,20],[1,10],[9,21],[10,25],[9,24],[14,20],[9,25],[8,13],[7,12],[5,13],[6,10],[2,5],[2,18],[14,19],[1,11],[7,22],[18,25],[11,19],[18,19],[4,18],[17,18],[2,11]], 25)});
    it('1136. 4', () => {test(28, [[5,28],[4,6],[8,14],[9,26],[7,9],[9,11],[7,22],[14,20],[1,7],[21,24],[13,14],[6,14],[1,25],[2,24],[14,23],[9,22],[8,26],[14,28],[4,26],[16,18],[13,15],[4,10],[18,23],[3,8],[6,19],[16,26],[11,19],[9,24],[23,28],[18,20],[4,24],[5,8],[13,19],[1,27],[2,12],[12,15],[2,10],[4,21],[7,16],[1,4],[8,12],[13,25],[12,24],[14,22],[8,20],[20,24],[13,24],[7,21],[18,26],[3,17],[2,15],[14,17],[6,16],[4,20],[8,9],[15,19],[17,18],[2,9],[14,26],[19,26],[4,17],[8,15],[5,20],[8,28],[5,25],[6,26],[7,28],[3,5],[7,12],[6,11],[17,28],[3,25],[6,7],[14,25],[2,19],[20,22],[10,21],[22,23],[2,17],[12,20],[25,28],[4,15],[2,26],[19,27],[11,18],[5,12],[2,21],[6,17],[2,7],[19,25],[1,22],[17,25],[13,21],[18,24],[11,25],[4,14],[16,20],[5,23],[4,27],[5,17],[9,20],[15,18],[23,25],[3,20],[3,13],[4,8],[23,26],[10,27],[6,13],[2,22],[7,18],[1,17],[5,27],[6,25],[20,25],[8,19],[5,22],[5,18],[11,22],[2,6],[7,17],[17,27],[4,19],[8,13],[27,28],[6,9],[16,28],[21,26],[20,23],[10,28],[3,23],[11,20],[9,18],[1,16],[16,22],[23,27],[5,9],[9,15],[9,17],[5,19],[22,24],[18,19],[16,24],[1,20],[12,13],[2,23],[15,20],[7,8],[12,22],[6,8],[8,27],[8,17],[21,22],[14,15],[3,22],[7,19],[12,26],[22,28],[16,23],[3,21],[5,15],[2,25],[25,26],[22,27],[19,24],[7,13],[16,21],[4,18],[19,20],[1,21],[3,12],[8,24],[9,16],[7,20],[12,28],[15,26],[24,27],[2,27],[17,26],[24,25],[11,28],[5,26],[12,27],[21,27],[3,18],[7,11],[14,19],[1,6],[15,27],[1,5],[2,20],[18,28],[3,6],[12,23],[10,11],[3,28],[10,13],[24,26],[13,17],[2,13],[10,12],[1,19],[5,13],[10,23],[24,28],[8,23],[2,11],[6,12],[3,26],[14,16],[15,21],[10,16],[13,26],[2,18],[12,18],[13,22],[13,18],[10,19],[15,24],[14,27],[3,14],[3,11],[10,17],[3,24],[22,25],[2,4],[1,3],[6,27],[9,23],[6,28],[5,16],[1,28],[13,20],[2,16],[6,10],[10,26],[26,27],[12,19],[18,21],[9,27],[14,21],[1,14],[14,18],[9,25],[20,28],[20,26],[4,16],[5,11],[4,5],[1,8],[9,19],[15,28],[13,16],[9,21],[15,16],[4,28],[3,19],[20,21],[3,4],[2,8],[23,24],[4,12],[4,7],[3,9],[5,6],[1,24],[16,17],[1,26],[5,21],[15,17],[8,21],[4,22],[10,24],[13,23],[11,26],[13,27],[18,22],[3,27],[6,21],[12,21],[22,26],[15,23],[17,24],[11,23],[11,24],[7,26],[5,7],[8,25],[21,28],[9,28],[1,9],[10,25],[5,24],[10,18],[17,21],[11,27],[7,24],[7,23],[9,10],[11,21],[11,15],[17,20],[12,16],[10,22],[3,10],[1,18],[9,14],[17,19],[7,27],[15,25],[8,22],[1,15],[15,22],[6,18],[25,27],[12,25],[21,23],[12,17],[16,25],[16,19],[1,23],[1,13],[2,14],[4,23],[20,27],[8,10],[9,13],[1,11],[6,24],[11,17],[5,14],[2,5],[2,3],[4,25],[6,23],[8,16],[11,16],[3,16],[8,18],[12,14],[26,28],[19,23],[17,22],[19,28],[13,28],[9,12],[10,20],[11,13],[19,22],[6,22],[1,12],[1,2],[10,15],[7,10],[4,13],[3,7],[7,25],[6,20],[17,23],[18,27],[7,14],[11,12],[1,10],[10,14],[3,15],[18,25],[21,25],[14,24],[11,14],[8,11],[19,21],[5,10],[4,9],[7,15],[4,11],[2,28],[16,27],[6,15]], 25)});
});
